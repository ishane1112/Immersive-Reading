# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Immersive Reading (沉浸式阅读) is an open-source browser translation extension built with WXT framework and Vue 3. It provides immersive webpage translation supporting 20+ translation engines including traditional services (Microsoft, Google, DeepL) and AI models (OpenAI, Claude, DeepSeek, etc.).

## Development Commands

```bash
# Install dependencies (uses pnpm)
pnpm install

# Development mode (Chrome)
pnpm dev

# Development mode (Firefox)
pnpm dev:firefox

# Production build (Chrome)
pnpm build

# Production build (Firefox)
pnpm build:firefox

# Package extension for distribution
pnpm zip
pnpm zip:firefox

# Type checking
pnpm compile

# Documentation dev server
pnpm docs:dev
```

## Architecture

### Entry Points (entrypoints/)
- `content.ts` - Main content script injected into all pages. Sets up translation triggers (hotkeys, gestures, floating ball), mounts Vue components (FloatingBall, SelectionTranslator, TranslationStatus), and handles browser runtime messages
- `background.ts` - Service worker handling translation requests by routing to appropriate translation service
- `popup/` - Browser action popup UI built with Vue 3 and Element Plus

### Translation Services (entrypoints/service/)
- `_service.ts` - Service registry mapping service names to handler functions
- Individual service files implement translation API calls (microsoft.ts, google.ts, deepl.ts, claude.ts, deepseek.ts, etc.)
- `common.ts` - Shared handler for OpenAI-compatible APIs (OpenAI, Moonshot, Groq, etc.)

### Core Translation Logic (entrypoints/main/)
- `trans.ts` - Main translation orchestration: handles both single and bilingual translation modes, manages translation queue, caches results, and manipulates DOM to insert translations
- `dom.ts` - DOM manipulation utilities for grabbing translatable nodes and formatting HTML
- `compat.ts` - Site-specific compatibility handlers for unique DOM structures
- `x-show-more.ts` - Special handler for X.com/Twitter "Show more" functionality

### Utilities (entrypoints/utils/)
- `config.ts` - User configuration management via WXT storage
- `cache.ts` - Translation result caching
- `translateApi.ts` / `translateQueue.ts` - Translation request queue with concurrency control
- `floatingBall.ts` / `selectionTranslator.ts` - Vue component mounting utilities
- `option.ts` - Available options and service definitions

### Vue Components (components/)
- `FloatingBall.vue` - Draggable floating button for triggering full-page translation
- `SelectionTranslator.vue` - Popup for translating selected text
- `TranslationStatus.vue` - Translation progress indicator

### Documentation (docs/)
Built with VitePress. Configuration in `docs/.vitepress/config.ts`.

## Code Conventions

- TypeScript with Vue 3 Composition API
- 2-space indentation for .ts, .vue, .css files
- Element Plus for UI components
- WXT auto-imports (`defineContentScript`, `defineBackground`, `storage`, `browser`)
- CSS class prefix: `fluent-read-` for translation-related DOM elements

## Build Output

Extension builds output to `.output/` directory. The manifest is auto-generated by WXT based on `wxt.config.ts`.
